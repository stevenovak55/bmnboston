(self.webpackChunkmls_listings_display=self.webpackChunkmls_listings_display||[]).push([[297],{210:function(t,n,e){e(692)(document).ready(function(t){"use strict";let n;function e(){t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_get_statistics",nonce:mldAdmin.nonce},success:function(n){if(n.success&&n.data){const e=n.data;t(".mld-stat-schools .stat-value").text(e.schools||0),t(".mld-stat-boundaries .stat-value").text(e.boundaries||0),e.last_import&&(e.last_import.schools&&t(".mld-stat-schools .stat-label").append("<br><small>Last import: "+e.last_import.schools+"</small>"),e.last_import.boundaries&&t(".mld-stat-boundaries .stat-label").append("<br><small>Last import: "+e.last_import.boundaries+"</small>"))}}})}if(t(document).on("click",".mld-upload-button",function(e){e.preventDefault();const s=t(this),i=s.data("target-input"),a=s.data("target-preview");n||(n=wp.media.frames.file_frame=wp.media({title:"Choose an Icon or Logo",button:{text:"Use this image"},multiple:!1}),n.on("select",function(){const e=n.state().get("selection").first().toJSON();t(i).val(e.url),t(a).html('<img src="'+e.url+'" />')})),n.open()}),t("#mld-import-schools").on("submit",function(n){n.preventDefault();const s=t("#schools-state").val(),i=t(this).find('button[type="submit"]'),a=t("#schools-progress"),o=t("#import-results"),r=i.text(),l=t(this).find('input[name="clear_existing"]').is(":checked");if(!s)return void alert("Please select a state");i.prop("disabled",!0).text("Importing..."),a.show(),o.hide(),a.html(`\n          <div class="notice notice-info">\n              <h3>Import Progress</h3>\n              <div class="progress-bar" style="background: #f0f0f0; height: 30px; border-radius: 3px; margin: 10px 0;">\n                  <div class="progress-bar-fill" style="background: #0073aa; height: 100%; width: 0%; transition: width 0.3s; border-radius: 3px;"></div>\n              </div>\n              <p class="progress-text">Starting import for ${s}...</p>\n              <div class="progress-details" style="margin-top: 10px;">\n                  <ul>\n                      <li>Imported: <span class="imported-count">0</span></li>\n                      <li>Skipped: <span class="skipped-count">0</span></li>\n                      <li>Errors: <span class="error-count">0</span></li>\n                  </ul>\n              </div>\n              <div class="current-item" style="margin-top: 10px; font-style: italic;"></div>\n          </div>\n      `);let c=setInterval(function(){const t=parseFloat(a.find(".progress-bar-fill").css("width"))/parseFloat(a.find(".progress-bar").css("width"))*100;t<90&&(a.find(".progress-bar-fill").css("width",t+5+"%"),a.find(".progress-text").text(`Processing schools for ${s}... ${Math.round(t+5)}%`))},500);t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_import_schools",state:s,clear_existing:l?"1":"0",nonce:mldAdmin.nonce},success:function(t){clearInterval(c),t.success?(a.find(".progress-bar-fill").css("width","100%"),a.find(".progress-text").text("Import completed!"),a.html(`\n                      <div class="notice notice-success">\n                          <p><strong>${t.data.message}</strong></p>\n                          <ul>\n                              <li>Total Imported: ${t.data.imported}</li>\n                              <li>Duplicates Skipped: ${t.data.skipped||0}</li>\n                          </ul>\n                      </div>\n                  `),t.data.details_html&&o.show().html(`\n                          <div class="mld-import-results">\n                              ${t.data.details_html}\n                          </div>\n                      `),e()):a.html('<div class="notice notice-error"><p>Error: '+(t.data||"Import failed")+"</p></div>")},error:function(t,n,e){clearInterval(c),a.html(`\n                  <div class="notice notice-error">\n                      <p>Import failed: ${e}</p>\n                      <p>Please check your connection and try again.</p>\n                  </div>\n              `)},complete:function(){i.prop("disabled",!1).text(r)}})}),t("#mld-import-boundaries").on("submit",function(n){n.preventDefault();const s=t("#boundaries-state").val(),i=t(this).find('button[type="submit"]'),a=t("#boundaries-progress"),o=i.text();s?(i.prop("disabled",!0).text("Importing..."),a.show().html('<div class="notice notice-info"><p>Starting import for '+s+"...</p></div>"),t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_import_boundaries",state:s,nonce:mldAdmin.nonce},success:function(t){t.success?(a.html('<div class="notice notice-success"><p>'+t.data.message+"</p></div>"),e()):a.html('<div class="notice notice-error"><p>Error: '+t.data+"</p></div>")},error:function(){a.html('<div class="notice notice-error"><p>Import failed. Please try again.</p></div>')},complete:function(){i.prop("disabled",!1).text(o)}})):alert("Please select a state")}),t(".mld-statistics-grid").length&&e(),t(".clear-data-btn").on("click",function(n){n.preventDefault();const s=t(this).data("type"),i=s.charAt(0).toUpperCase()+s.slice(1);if(!confirm("Are you sure you want to clear all "+i+" data? This cannot be undone."))return;const a=t(this),o=a.text();a.prop("disabled",!0).text("Clearing..."),t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_clear_data",data_type:s,nonce:mldAdmin.nonce},success:function(t){t.success?(alert(t.data.message),e()):alert("Error: "+t.data)},error:function(){alert("Failed to clear data. Please try again.")},complete:function(){a.prop("disabled",!1).text(o)}})}),t(document).on("change",".toggle-notifications",function(){const n=t(this),e=n.data("id"),s=n.is(":checked"),i=n.closest("td").find(".notifications-status");i.length&&i.text(s?"On":"Off"),t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_toggle_search_notifications",search_id:e,enabled:s?1:0,nonce:mldAdmin.nonce||("undefined"!=typeof mldSavedSearchAdmin?mldSavedSearchAdmin.nonce:"")},success:function(t){t.success||(n.prop("checked",!s),i.length&&i.text(s?"Off":"On"),alert("Failed to update notification settings: "+(t.data||"Unknown error")))},error:function(){n.prop("checked",!s),i.length&&i.text(s?"Off":"On"),alert("Failed to update notification settings. Please try again.")}})}),t(document).on("click",".toggle-notifications-global",function(){const n=t(this),e="true"===n.data("enabled"),s=n.text();n.prop("disabled",!0).text("Updating..."),t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_toggle_notifications",enabled:e,nonce:mldAdmin.nonce},success:function(t){t.success?location.reload():alert("Error: "+t.data)},error:function(){alert("Failed to update notification settings")},complete:function(){n.prop("disabled",!1).text(s)}})}),t(document).on("click",".send-test-notification",function(){const n=t(this),e=n.html();n.prop("disabled",!0).html('<span class="dashicons dashicons-update spin"></span> Sending...'),t.ajax({url:ajaxurl,type:"POST",data:{action:"mld_send_test_notification",nonce:mldAdmin.nonce},success:function(t){t.success?alert("Test notification sent successfully!"):alert("Error: "+t.data)},error:function(){alert("Failed to send test notification")},complete:function(){n.prop("disabled",!1).html(e)}})}),!document.querySelector("#mld-admin-styles")){const t=document.createElement("style");t.id="mld-admin-styles",t.textContent='\n          .spin {\n              animation: mld-spin 1s linear infinite;\n          }\n          @keyframes mld-spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n          }\n          .switch {\n              position: relative;\n              display: inline-block;\n              width: 44px;\n              height: 24px;\n              margin-right: 10px;\n          }\n          .switch input {\n              opacity: 0;\n              width: 0;\n              height: 0;\n          }\n          .slider {\n              position: absolute;\n              cursor: pointer;\n              top: 0;\n              left: 0;\n              right: 0;\n              bottom: 0;\n              background-color: #ccc;\n              transition: 0.4s;\n          }\n          .slider:before {\n              position: absolute;\n              content: "";\n              height: 18px;\n              width: 18px;\n              left: 3px;\n              bottom: 3px;\n              background-color: white;\n              transition: 0.4s;\n          }\n          input:checked + .slider {\n              background-color: #4CAF50;\n          }\n          input:checked + .slider:before {\n              transform: translateX(20px);\n          }\n          .slider.round {\n              border-radius: 24px;\n          }\n          .slider.round:before {\n              border-radius: 50%;\n          }\n      ',document.head.appendChild(t)}})}},function(t){t.O(0,[96],function(){return n=210,t(t.s=n);var n});t.O()}]);
//# sourceMappingURL=admin-bundle.d0867920.min.js.map