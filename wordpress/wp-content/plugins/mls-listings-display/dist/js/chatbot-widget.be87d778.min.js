"use strict";(self.webpackChunkmls_listings_display=self.webpackChunkmls_listings_display||[]).push([[581],{7:function(){class e{constructor(){this.isOpen=!1,this.sessionId=this.generateSessionId(),this.heartbeatInterval=null,this.lastActivityTime=Date.now(),this.isTyping=!1,this.messageQueue=[],this.config=window.mldChatbot||{},this.ajaxUrl=this.config.ajaxUrl||"/wp-admin/admin-ajax.php",this.nonce=this.config.nonce||"",this.init()}init(){this.injectHTML(),this.attachEventListeners(),this.startHeartbeat(),this.handlePageUnload()}generateSessionId(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}injectHTML(){const e=`\n            <div id="mld-chatbot-widget" class="mld-chatbot-widget" data-session="${this.sessionId}">\n                \x3c!-- Chat Bubble --\x3e\n                <div class="mld-chat-bubble" id="mld-chat-bubble">\n                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>\n                        <circle cx="12" cy="10" r="1.5"/>\n                        <circle cx="8" cy="10" r="1.5"/>\n                        <circle cx="16" cy="10" r="1.5"/>\n                    </svg>\n                    <span class="mld-chat-badge" id="mld-chat-badge" style="display: none;">1</span>\n                </div>\n\n                \x3c!-- Chat Window --\x3e\n                <div class="mld-chat-window" id="mld-chat-window" style="display: none;">\n                    \x3c!-- Header --\x3e\n                    <div class="mld-chat-header">\n                        <div class="mld-chat-header-info">\n                            <div class="mld-chat-avatar">\n                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>\n                                </svg>\n                            </div>\n                            <div class="mld-chat-header-text">\n                                <h3>Property Assistant</h3>\n                                <span class="mld-chat-status">Online</span>\n                            </div>\n                        </div>\n                        <button class="mld-chat-close" id="mld-chat-close" aria-label="Close chat">\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n                            </svg>\n                        </button>\n                    </div>\n\n                    \x3c!-- Messages Container --\x3e\n                    <div class="mld-chat-messages" id="mld-chat-messages">\n                        <div class="mld-chat-message mld-bot-message">\n                            <div class="mld-message-content">\n                                <p>Hello! ðŸ‘‹ I'm your AI property assistant. How can I help you today?</p>\n                            </div>\n                            <div class="mld-message-time">${this.getCurrentTime()}</div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Typing Indicator --\x3e\n                    <div class="mld-typing-indicator" id="mld-typing-indicator" style="display: none;">\n                        <span></span>\n                        <span></span>\n                        <span></span>\n                    </div>\n\n                    \x3c!-- Input Area --\x3e\n                    <div class="mld-chat-input-container">\n                        <textarea\n                            id="mld-chat-input"\n                            class="mld-chat-input"\n                            placeholder="Type your message..."\n                            rows="1"\n                            maxlength="1000"\n                        ></textarea>\n                        <button id="mld-chat-send" class="mld-chat-send" aria-label="Send message">\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">\n                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n                            </svg>\n                        </button>\n                    </div>\n\n                    \x3c!-- Powered By --\x3e\n                    <div class="mld-chat-footer">\n                        <span>Powered by AI</span>\n                    </div>\n                </div>\n            </div>\n        `;document.body.insertAdjacentHTML("beforeend",e)}attachEventListeners(){const e=document.getElementById("mld-chat-bubble");e?.addEventListener("click",()=>this.toggleChat());const t=document.getElementById("mld-chat-close");t?.addEventListener("click",()=>this.closeChat());const n=document.getElementById("mld-chat-send");n?.addEventListener("click",()=>this.sendMessage());const s=document.getElementById("mld-chat-input");s?.addEventListener("keydown",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.sendMessage())}),s?.addEventListener("input",e=>{e.target.style.height="auto",e.target.style.height=Math.min(e.target.scrollHeight,120)+"px"})}toggleChat(){this.isOpen?this.closeChat():this.openChat()}openChat(){const e=document.getElementById("mld-chat-window"),t=document.getElementById("mld-chat-bubble"),n=document.getElementById("mld-chat-badge");e.style.display="flex",t.classList.add("mld-chat-bubble-hidden"),n.style.display="none",this.isOpen=!0,this.scrollToBottom(),setTimeout(()=>{document.getElementById("mld-chat-input")?.focus()},300)}closeChat(){const e=document.getElementById("mld-chat-window"),t=document.getElementById("mld-chat-bubble");e.style.display="none",t.classList.remove("mld-chat-bubble-hidden"),this.isOpen=!1,this.endSession()}async sendMessage(){const e=document.getElementById("mld-chat-input"),t=e?.value.trim();if(t){e.value="",e.style.height="auto",this.addMessage(t,"user"),this.showTyping(),this.lastActivityTime=Date.now();try{const e=await this.sendToBackend(t);this.hideTyping(),e.success?this.addMessage(e.data.message,"bot",{isFallback:e.data.is_fallback||!1,metadata:e.data.metadata||null}):this.addMessage("Sorry, I encountered an error. Please try again or contact us directly.","bot",{isError:!0})}catch(e){this.hideTyping(),this.addMessage("Connection error. Please check your internet connection and try again.","bot",{isError:!0})}this.scrollToBottom()}}addMessage(e,t="bot",n={}){const s=document.getElementById("mld-chat-messages"),a="user"===t?"mld-user-message":"mld-bot-message",i=document.createElement("div");i.className=`mld-chat-message ${a}`,n.isError&&i.classList.add("mld-message-error"),n.isFallback&&i.classList.add("mld-message-fallback"),i.innerHTML=`\n            <div class="mld-message-content">\n                <p>${this.escapeHtml(e)}</p>\n                ${n.isFallback?'<span class="mld-fallback-badge">FAQ</span>':""}\n            </div>\n            <div class="mld-message-time">${this.getCurrentTime()}</div>\n        `,s.appendChild(i),this.scrollToBottom(),this.isOpen||"bot"!==t||this.showNotificationBadge()}showTyping(){const e=document.getElementById("mld-typing-indicator");e&&(e.style.display="flex",this.scrollToBottom())}hideTyping(){const e=document.getElementById("mld-typing-indicator");e&&(e.style.display="none")}showNotificationBadge(){const e=document.getElementById("mld-chat-badge");if(e&&!this.isOpen){e.style.display="flex";const t=document.getElementById("mld-chat-bubble");t?.classList.add("mld-chat-bubble-bounce"),setTimeout(()=>{t?.classList.remove("mld-chat-bubble-bounce")},1e3)}}async sendToBackend(e){const t=new FormData;t.append("action","mld_chat_send_message"),t.append("nonce",this.nonce),t.append("message",e),t.append("session_id",this.sessionId),t.append("user_data",JSON.stringify(this.getUserData()));const n=await fetch(this.ajaxUrl,{method:"POST",body:t});return await n.json()}getUserData(){return{page_url:window.location.href,referrer_url:document.referrer,device_type:this.getDeviceType(),browser:this.getBrowser()}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.sendHeartbeat()},12e4)}async sendHeartbeat(){const e=new FormData;e.append("action","mld_session_heartbeat"),e.append("nonce",this.nonce),e.append("session_id",this.sessionId);try{await fetch(this.ajaxUrl,{method:"POST",body:e})}catch(e){}}async endSession(){const e=new FormData;e.append("action","mld_session_close"),e.append("nonce",this.nonce),e.append("session_id",this.sessionId);try{await fetch(this.ajaxUrl,{method:"POST",body:e})}catch(e){}}handlePageUnload(){window.addEventListener("beforeunload",()=>{if(this.isOpen){const e=new FormData;e.append("action","mld_session_close"),e.append("nonce",this.nonce),e.append("session_id",this.sessionId);const t=new Blob([new URLSearchParams(e).toString()],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(this.ajaxUrl,t)}this.heartbeatInterval&&clearInterval(this.heartbeatInterval)})}scrollToBottom(){const e=document.getElementById("mld-chat-messages");e&&setTimeout(()=>{e.scrollTop=e.scrollHeight},100)}getCurrentTime(){return(new Date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}getDeviceType(){const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"}getBrowser(){const e=navigator.userAgent;let t="Unknown";return e.includes("Firefox/")?t="Firefox":e.includes("Edg/")?t="Edge":e.includes("Chrome/")?t="Chrome":e.includes("Safari/")&&(t="Safari"),t}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.mldChatbotWidget=new e}):window.mldChatbotWidget=new e}},function(e){var t;t=7,e(e.s=t)}]);
//# sourceMappingURL=chatbot-widget.be87d778.min.js.map